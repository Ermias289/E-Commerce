2025-09-10 00:40:16 - chatbot.main - ERROR - main.py:89 - Error in chat endpoint: Got unsupported early_stopping_method `generate`
Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\main.py", line 64, in chat_with_agent
    result = agent_executor.invoke({
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\langchain\chains\base.py", line 165, in invoke
    self._call(inputs, run_manager=run_manager)
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\langchain\agents\agent.py", line 1652, in _call
    output = self._action_agent.return_stopped_response(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\langchain\agents\agent.py", line 312, in return_stopped_response
    raise ValueError(msg)
ValueError: Got unsupported early_stopping_method `generate`
2025-09-10 09:01:34 - chatbot.main - ERROR - main.py:38 - Failed to initialize agent: Vector store initialization failed
Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\main.py", line 35, in lifespan
    agent_executor = create_agent()
                     ^^^^^^^^^^^^^^
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\tools\langchain_agent.py", line 65, in create_agent
    raise Exception("Vector store initialization failed")
Exception: Vector store initialization failed
2025-09-10 09:24:25 - chatbot.main - ERROR - main.py:99 - Error in CrewAI endpoint: name 'crew_service' is not defined
Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\main.py", line 83, in chat_with_crew
    if not crew_service or not crew_service._initialized:
           ^^^^^^^^^^^^
NameError: name 'crew_service' is not defined
2025-09-10 09:41:54 - chatbot.main - ERROR - main.py:75 - Health check failed: name 'crew_service' is not defined
2025-09-10 09:43:12 - chatbot.main - ERROR - main.py:99 - Error in CrewAI endpoint: name 'crew_service' is not defined
Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\main.py", line 83, in chat_with_crew
    if not crew_service or not crew_service._initialized:
           ^^^^^^^^^^^^
NameError: name 'crew_service' is not defined
2025-09-10 12:02:34 - chatbot.main - ERROR - crew_service.py:237 - Error processing query: litellm.InternalServerError: litellm.InternalServerError: VertexAIException - {
  "error": {
    "code": 503,
    "message": "The model is overloaded. Please try again later.",
    "status": "UNAVAILABLE"
  }
}
Traceback (most recent call last):
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\llms\vertex_ai\gemini\vertex_and_google_ai_studio_gemini.py", line 1890, in completion
    response = client.post(url=url, headers=headers, json=data)  # type: ignore
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\llms\custom_httpx\http_handler.py", line 780, in post
    raise e
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\llms\custom_httpx\http_handler.py", line 762, in post
    response.raise_for_status()
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\httpx\_models.py", line 829, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Server error '503 Service Unavailable' for url 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyDc1b964Iqbq5VGFhq8ndaBirDdbCs_9DU'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/503

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\main.py", line 2606, in completion
    response = vertex_chat_completion.completion(  # type: ignore
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\llms\vertex_ai\gemini\vertex_and_google_ai_studio_gemini.py", line 1894, in completion
    raise VertexAIError(
litellm.llms.vertex_ai.common_utils.VertexAIError: {
  "error": {
    "code": 503,
    "message": "The model is overloaded. Please try again later.",
    "status": "UNAVAILABLE"
  }
}


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\crew_service.py", line 233, in process_query
    result = final_crew.kickoff()
             ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\crew.py", line 662, in kickoff
    result = self._run_sequential_process()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\crew.py", line 776, in _run_sequential_process
    return self._execute_tasks(self.tasks)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\crew.py", line 879, in _execute_tasks
    task_output = task.execute_sync(
                  ^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\task.py", line 381, in execute_sync
    return self._execute_core(agent, context, tools)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\task.py", line 529, in _execute_core
    raise e  # Re-raise the exception after emitting the event
    ^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\task.py", line 445, in _execute_core
    result = agent.execute_task(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\agent.py", line 475, in execute_task
    raise e
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\agent.py", line 451, in execute_task
    result = self._execute_without_timeout(task_prompt, task)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\agent.py", line 547, in _execute_without_timeout
    return self.agent_executor.invoke(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\agents\crew_agent_executor.py", line 114, in invoke
    formatted_answer = self._invoke_loop()
                       ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\agents\crew_agent_executor.py", line 207, in _invoke_loop
    raise e
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\agents\crew_agent_executor.py", line 153, in _invoke_loop
    answer = get_llm_response(
             ^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\utilities\agent_utils.py", line 161, in get_llm_response
    raise e
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\utilities\agent_utils.py", line 154, in get_llm_response
    answer = llm.call(
             ^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\llm.py", line 1032, in call
    return self._handle_non_streaming_response(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\crewai\llm.py", line 813, in _handle_non_streaming_response
    response = litellm.completion(**params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\utils.py", line 1330, in wrapper
    raise e
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\utils.py", line 1205, in wrapper
    result = original_function(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\main.py", line 3427, in completion
    raise exception_type(
          ^^^^^^^^^^^^^^^
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\litellm_core_utils\exception_mapping_utils.py", line 2301, in exception_type
    raise e
  File "C:\Users\Admin\miniconda3\envs\Ecommerce\Lib\site-packages\litellm\litellm_core_utils\exception_mapping_utils.py", line 1284, in exception_type
    raise litellm.InternalServerError(
litellm.exceptions.InternalServerError: litellm.InternalServerError: litellm.InternalServerError: VertexAIException - {
  "error": {
    "code": 503,
    "message": "The model is overloaded. Please try again later.",
    "status": "UNAVAILABLE"
  }
}

2025-09-10 14:51:11 - chatbot.main - ERROR - main.py:49 - Failed to initialize agent: Failed to initialize VectorStoreClient: COHERE_API_KEY environment variable not set.
Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\services\vector_store.py", line 24, in __init__
    raise ValueError("COHERE_API_KEY environment variable not set.")
ValueError: COHERE_API_KEY environment variable not set.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\main.py", line 34, in lifespan
    get_vector_client()
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\src\chatbot_backend\tools\custom_tool.py", line 29, in get_vector_client
    _vector_client = VectorStoreClient()
                     ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Admin\Desktop\E-Commerce\chatbot_backend\services\vector_store.py", line 49, in __init__
    raise RuntimeError(f"Failed to initialize VectorStoreClient: {e}")
RuntimeError: Failed to initialize VectorStoreClient: COHERE_API_KEY environment variable not set.
